==========================================================================
IronPort Reporting API Tools

Copyright IronPort Systems 2005
===========================================================================
Overview
---------------------------------------------------------------------------

This package contains tools that can be used for processing mail flow
data retrieved IronPort appliances through the Reporting API Preview
that is available in AsyncOS 4.5.5.  These tools are provided with
source code under the GNU Public License for the use of IronPort
customers to extend and modify as they need.

The main script is iprpt-crunch.pl, and will read in data, summarize
the numbers, and output results in either text or HTML format.  The
current HTML format relies on a third party graphing library called
FusionCharts, please see the "Graphing Libraries" section below for
more information.

===========================================================================
Usage
---------------------------------------------------------------------------

All of these files operate on the CSV data provided by the AsyncOS
4.5.5 Reporting API.  For information on retrieving this information
from Mail Flow Monitor v2 please read:

    doc/IronPort_AsyncOS_4_5_5_Reporting_API.pdf

A typical URL for retrieving a weeks worth of data from a machine
would look like:

   https://mga.company.com/csv/mailflow_csv?interval=day;startTime=10/23;endTime=10/29

Note that you will need to supply a username and password to whatever
tool you use to retrieve the data.

The simplest operation is to generate a text report:

    ./iprpt-crunch.pl -t < mailflow.csv > report.txt

You can also create an HTML report using FusionCharts graphs.  The
report format is defined in report-shell.html and will use Flash files
from the swf/ directory and XML files in the data/ directory.  To
generate the appropriate data files use the command:

    ./iprpt-crunch.pl -d data < mailflow.csv

The script can aggregate reporting data from multiple machines by
simply piping multiple CSV files into the script one after the other.

===========================================================================
Files
---------------------------------------------------------------------------

iprpt-crunch.pl -- Script to crunch CSV files and output text or XML
		   data for reports
doc/ -- Documentation directory
report-shell.html -- An HTML shell of a report that will load XML
		     graph data output by 'iprpt-crunch.pl -d <dir>'
data/ -- Default output directory for XML files references by
         report-shell.html
swf/ -- Directory for FusionCharts flash files used by report-shell.html
t/ -- Example CSV files and known good text output to compare against

===========================================================================
Graphing Libraries
---------------------------------------------------------------------------

To generate HTML reports with graphs you will need a graphing engine
to render the data.  We have included example support for InfoSoft Global's
FusionCharts engine, but you are welcome to add support for whatever
graphing engine you prefer.

To use the FusionCharts graphing engine you will need to acquire the
FusionCharts 2.3 release from:

        http://www.infosoftglobal.com/FusionCharts/

Then copy the following Flash files from the distribution into the
swf/ directory:

FC_2_3_Bar2D.swf
FC_2_3_Pie2D.swf
FC_2_3_StckdColumn2D.swf
FC_2_3_Column2D.swf
FC_2_3_SSGrid.swf

An example report generated by FusionCharts is available in
doc/example-overview.pdf

===========================================================================
Design
---------------------------------------------------------------------------

iprpt-crunch.pl works in three main steps:

1) Make one pass through all CSV files to aggregate "records" into
   "buckets" based on different "keys"
2) Make a pass through certain "buckets" to look for "toplists" (top N
   senders based on specific "fields")
3) Output text, HTML, etc

Right now it creates three buckets in step 1:
   time_records -- Aggregate all records for specific time periods
   domain_records -- Aggregate records based on the primaryDomain" field
   total_record -- One record for all data (less "TOTAL" lines)

It then looks through the domain_records bucket to create a Top 10
list for Threat and Clean message senders.

Finally, it outputs the requested report in either text or as XML
files in the data/ directory for use by shell-report.html

To extend iprpt-crunch.pl you should be able to add code where
comments are marked with EXTEND.

===========================================================================
Future
---------------------------------------------------------------------------

o Add a script to execute multiple 'curl' retrievals of CSV data and
  pipe them all to iprpt-crunch, drop that into a crob job and
  automate.

===========================================================================
License
---------------------------------------------------------------------------

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or (at
your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301
USA
===========================================================================
